name: System.VFS.ListDirectory
parameters:
  - name: Path
    description: The path of the file to download.
    default: "/"

  - name: Components
    type: json_array

  - name: Accessor
    default: file

  - name: Depth
    type: int
    default: 0

sources:
  - query: |
      LET RecursiveLS = SELECT * FROM foreach(row={
        SELECT OSPath FROM glob(
          globs=format(format='/**%v', args=Depth),
          root=Components,
          accessor=Accessor)
        WHERE IsDir
      }, query={
        SELECT * FROM vfs_ls(
           components=OSPath.Components,
           accessor=Accessor)
      })

      SELECT * FROM if(condition=Depth,
      then=RecursiveLS,
      else={
        SELECT * FROM vfs_ls(
           components=Components, accessor=Accessor)
      })
